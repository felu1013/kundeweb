{"ast":null,"code":"import _asyncToGenerator from \"C:/software-engineering/kundeweb/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\nvar _CreateKundeComponent_instances, _CreateKundeComponent_setProps, _CreateKundeComponent_handleError, _CreateKundeComponent_navigateHome;\n\nimport { __classPrivateFieldGet, __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { toKunde } from './kundeForm';\nimport { SaveError } from '../shared'; // eslint-disable-line @typescript-eslint/consistent-type-imports\n\nimport { first, tap } from 'rxjs/operators';\nimport { FormGroup } from '@angular/forms';\nimport log from 'loglevel';\n/**\r\n * Komponente mit dem Tag create kunde, um das Erfassungsformular\r\n * für ein neuen Kunden zu realisieren\r\n */\n\nlet CreateKundeComponent = class CreateKundeComponent {\n  constructor(service, router, titleService) {\n    this.service = service;\n    this.router = router;\n    this.titleService = titleService;\n\n    _CreateKundeComponent_instances.add(this);\n\n    this.createForm = new FormGroup({});\n    this.shotWarning = false;\n    this.fertig = false;\n    this.errorMsg = undefined;\n    log.debug('CreateKundeComponent.constructor: Injizierter Router:', router);\n  }\n\n  ngOnInit() {\n    this.titleService.setTitle('Neuer Kunde');\n  }\n  /**\r\n   * Die Methode realisiert den Event Handler, wenn das\r\n   * Formular abgeschickt wird, um ein neuen Kunden anzulegen\r\n   * @return flase, um das durch den Button Klick ausgelöste Ereignis zu konsumieren\r\n   */\n\n\n  onSubmit() {\n    if (this.createForm.invalid) {\n      log.debug('CreateKundeComponent.onSubmit: Validierungsfehler', this.createForm);\n    }\n\n    const kundeForm = this.createForm.value;\n    const neuerKunde = toKunde(kundeForm);\n    log.debug('CreateKundeComponent.onSubmit: neuerKunde=', neuerKunde);\n    this.service.save(neuerKunde).pipe(first(), tap(result => __classPrivateFieldGet(this, _CreateKundeComponent_instances, \"m\", _CreateKundeComponent_setProps).call(this, result))).subscribe({\n      next: () => __classPrivateFieldGet(this, _CreateKundeComponent_instances, \"m\", _CreateKundeComponent_navigateHome).call(this)\n    });\n  }\n\n};\n_CreateKundeComponent_instances = new WeakSet(), _CreateKundeComponent_setProps = function _CreateKundeComponent_setProps(result) {\n  if (result instanceof SaveError) {\n    __classPrivateFieldGet(this, _CreateKundeComponent_instances, \"m\", _CreateKundeComponent_handleError).call(this, result);\n\n    return;\n  }\n\n  this.fertig = true;\n  this.shotWarning = false;\n  this.errorMsg = undefined;\n  const id = result;\n  log.debug('CreateKundeComponent.#setProps: id=', id);\n}, _CreateKundeComponent_handleError = function _CreateKundeComponent_handleError(err) {\n  const {\n    statuscode\n  } = err;\n  log.debug(`CreateKundeComponent.#handleError: statuscode=${statuscode}, err=`, err);\n\n  switch (statuscode) {\n    case 422\n    /* UnprocessableEntity */\n    :\n      {\n        const {\n          cause\n        } = err; // TODO Aufbereitung der Fehlermeldung u.a. Anfuerungszeichen\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\n        this.errorMsg = cause instanceof HttpErrorResponse ? cause.error : JSON.stringify(cause);\n        break;\n      }\n\n    case 429\n    /* TooManyRequests */\n    :\n      this.errorMsg = 'Zu viele Anfragen, bitte versuchen Sie es später noch einmal';\n      break;\n\n    case 504\n    /* GatewayTimeout */\n    :\n      this.errorMsg = 'Ein interner Fehler ist aufgetreten';\n      log.error('Laeuft der Appserver? Port Forwarding?');\n      break;\n\n    default:\n      this.errorMsg = 'Ein unbekannter Fehler ist aufgetreten';\n      break;\n  }\n}, _CreateKundeComponent_navigateHome = /*#__PURE__*/function () {\n  var _CreateKundeComponent_navigateHome2 = _asyncToGenerator(function* () {\n    if (this.errorMsg === undefined) {\n      log.debug('CreateKundeComponent.#navigateHome: Navigation:');\n      yield this.router.navigate(['/']);\n    }\n  });\n\n  function _CreateKundeComponent_navigateHome() {\n    return _CreateKundeComponent_navigateHome2.apply(this, arguments);\n  }\n\n  return _CreateKundeComponent_navigateHome;\n}();\nCreateKundeComponent = __decorate([Component({\n  selector: 'hs-create-kunde',\n  templateUrl: './create-kunde.component.html'\n})], CreateKundeComponent);\nexport { CreateKundeComponent };","map":null,"metadata":{},"sourceType":"module"}