{"ast":null,"code":"import _asyncToGenerator from \"C:/software-engineering/kundeweb/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\nvar _UpdateKundeComponent_instances, _UpdateKundeComponent_setProps, _UpdateKundeComponent_handleFindError, _UpdateKundeComponent_handleUpdateResult, _UpdateKundeComponent_navigateHome;\n\nimport { __classPrivateFieldGet } from \"tslib\";\n/* eslint-disable @typescript-eslint/consistent-type-imports */\n\nimport { FindError, UpdateError } from '../shared';\n/* eslint-enable @typescript-eslint/consistent-type-imports */\n\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { first, tap } from 'rxjs/operators';\nimport { FormGroup } from '@angular/forms';\nimport log from 'loglevel';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../shared\";\nimport * as i2 from \"@angular/platform-browser\";\nimport * as i3 from \"@angular/router\";\n\nfunction UpdateKundeComponent_section_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"section\", 2)(1, \"h4\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 3)(4, \"form\", 4);\n    i0.ɵɵlistener(\"submit\", function UpdateKundeComponent_section_0_Template_form_submit_4_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onSubmit());\n    });\n    i0.ɵɵelement(5, \"hs-update-nachname\", 5)(6, \"hs-update-geschlecht\", 5)(7, \"hs-update-kategorie\", 5)(8, \"hs-update-email\", 5);\n    i0.ɵɵelementStart(9, \"div\", 6)(10, \"div\", 7)(11, \"button\", 8)(12, \"i\", 9);\n    i0.ɵɵtext(13, \"check\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"span\", 10);\n    i0.ɵɵtext(15, \"Stammdaten aktualisieren\");\n    i0.ɵɵelementEnd()()()()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Kunde \", ctx_r0.kunde.id, \":\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.updateForm);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"updateForm\", ctx_r0.updateForm)(\"currentValue\", ctx_r0.kunde.nachname);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"updateForm\", ctx_r0.updateForm)(\"currentValue\", ctx_r0.kunde.geschlecht);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"updateForm\", ctx_r0.updateForm)(\"currentValue\", ctx_r0.kunde.kategorie);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"updateForm\", ctx_r0.updateForm)(\"currentValue\", ctx_r0.kunde.email);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.updateForm.pristine || ctx_r0.updateForm.invalid);\n  }\n}\n/**\r\n * Komponente für das Tag hs update kunde\r\n */\n\n\nexport class UpdateKundeComponent {\n  // eslint-disable-next-line max-params\n  constructor(service, readService, titleService, router, route) {\n    this.service = service;\n    this.readService = readService;\n    this.titleService = titleService;\n    this.router = router;\n    this.route = route;\n\n    _UpdateKundeComponent_instances.add(this);\n\n    this.updateForm = new FormGroup({});\n    log.debug('UpdateKundeComponent.constructor()');\n  }\n\n  ngOnInit() {\n    var _a;\n\n    const id = (_a = this.route.snapshot.paramMap.get('id')) !== null && _a !== void 0 ? _a : undefined;\n    this.readService.findById(id).pipe(first(), tap(result => {\n      __classPrivateFieldGet(this, _UpdateKundeComponent_instances, \"m\", _UpdateKundeComponent_setProps).call(this, result);\n\n      log.debug('UpdateKundeComponent.ngOnInit: kunde=', this.kunde);\n    })).subscribe();\n  }\n  /**\r\n   * Die aktuellen Stammdaten für das angezeigte Kunde Objekt zurückschreiben\r\n   * @return false, um das durch den Button Klick ausgelöste Ereignis zu konsumieren\r\n   */\n\n\n  onSubmit() {\n    if (this.updateForm.pristine || this.kunde === undefined) {\n      log.debug('UpdateKundeComponent.onSubmit: keine Aenderung');\n      return;\n    }\n\n    const {\n      nachname\n    } = this.updateForm.value;\n    const {\n      geschlecht\n    } = this.updateForm.value;\n    const {\n      kategorie\n    } = this.updateForm.value;\n    const {\n      email\n    } = this.updateForm.value;\n    const {\n      kunde,\n      service\n    } = this;\n    kunde.nachname = nachname;\n    kunde.geschlecht = geschlecht;\n    kunde.kategorie = kategorie;\n    kunde.email = email;\n    log.debug('UpdateKundeComponent.onSubmit: kunde=', kunde);\n    service.update(kunde).pipe(first(), tap(result => __classPrivateFieldGet(this, _UpdateKundeComponent_instances, \"m\", _UpdateKundeComponent_handleUpdateResult).call(this, result))).subscribe({\n      next: () => __classPrivateFieldGet(this, _UpdateKundeComponent_instances, \"m\", _UpdateKundeComponent_navigateHome).call(this)\n    });\n    return false;\n  }\n\n}\n_UpdateKundeComponent_instances = new WeakSet(), _UpdateKundeComponent_setProps = function _UpdateKundeComponent_setProps(result) {\n  if (result instanceof FindError) {\n    __classPrivateFieldGet(this, _UpdateKundeComponent_instances, \"m\", _UpdateKundeComponent_handleFindError).call(this, result);\n\n    return;\n  }\n\n  this.kunde = result;\n  this.errorMsg = undefined;\n  const titel = `Aktualisieren ${this.kunde.id}`;\n  this.titleService.setTitle(titel);\n}, _UpdateKundeComponent_handleFindError = function _UpdateKundeComponent_handleFindError(err) {\n  const {\n    statuscode\n  } = err;\n  log.debug('UpdateKundeComponent.#handleFindError: statuscode=', statuscode);\n  this.kunde = undefined;\n\n  switch (statuscode) {\n    case 404\n    /* NotFound */\n    :\n      this.errorMsg = 'Kein Kunde gefunden';\n      break;\n\n    case 429\n    /* TooManyRequests */\n    :\n      this.errorMsg = 'Zu viele Anfragen, bitte versuchen Sie es später erneut';\n      break;\n\n    case 504\n    /* GatewayTimeout */\n    :\n      this.errorMsg = 'Ein interner Fehler ist aufgetreten';\n      log.error('Laeuft der Appserver und Port Forwarding?');\n      break;\n\n    default:\n      this.errorMsg = 'Ein unbekannter Fehler ist aufgetreten';\n      break;\n  }\n}, _UpdateKundeComponent_handleUpdateResult = function _UpdateKundeComponent_handleUpdateResult(result) {\n  if (!(result instanceof UpdateError)) {\n    return;\n  }\n\n  const {\n    statuscode\n  } = result;\n  log.debug('UpdateKundeComponent.#handleUpdateResult: statuscode=', statuscode);\n\n  switch (statuscode) {\n    case 422\n    /* UnprocessableEntity */\n    :\n      {\n        const {\n          cause\n        } = result; // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\n        this.errorMsg = cause instanceof HttpErrorResponse ? cause.error : JSON.stringify(cause);\n        break;\n      }\n\n    case 429\n    /* TooManyRequests */\n    :\n      this.errorMsg = 'Zu viele Anfragen, bitte später versuchen';\n      break;\n\n    case 504\n    /* GatewayTimeout */\n    :\n      this.errorMsg = 'Interner Fehler';\n      log.error('Laeuft Appserver und Port Forwarding?');\n      break;\n\n    default:\n      this.errorMsg = 'Ein unbekannter Fehler ist aufgetreten';\n      break;\n  }\n\n  log.debug('UpdateKundeComponent.#handleUpdateResult: errorMsg=', this.errorMsg);\n}, _UpdateKundeComponent_navigateHome = /*#__PURE__*/function () {\n  var _UpdateKundeComponent_navigateHome2 = _asyncToGenerator(function* () {\n    yield this.router.navigate(['/']);\n  });\n\n  function _UpdateKundeComponent_navigateHome() {\n    return _UpdateKundeComponent_navigateHome2.apply(this, arguments);\n  }\n\n  return _UpdateKundeComponent_navigateHome;\n}();\n\nUpdateKundeComponent.ɵfac = function UpdateKundeComponent_Factory(t) {\n  return new (t || UpdateKundeComponent)(i0.ɵɵdirectiveInject(i1.KundeWriteService), i0.ɵɵdirectiveInject(i1.KundeReadService), i0.ɵɵdirectiveInject(i2.Title), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i3.ActivatedRoute));\n};\n\nUpdateKundeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: UpdateKundeComponent,\n  selectors: [[\"hs-update-kunde\"]],\n  decls: 2,\n  vars: 2,\n  consts: [[\"class\", \"mt-1 ms-1\", 4, \"ngIf\"], [3, \"text\"], [1, \"mt-1\", \"ms-1\"], [1, \"mt-2\", \"ms-2\"], [\"role\", \"form\", 3, \"formGroup\", \"submit\"], [3, \"updateForm\", \"currentValue\"], [1, \"row\"], [1, \"col\", \"offset-2\", \"gy-3\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [1, \"material-icons\"], [1, \"ms-1\"]],\n  template: function UpdateKundeComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, UpdateKundeComponent_section_0_Template, 16, 11, \"section\", 0);\n      i0.ɵɵelement(1, \"hs-error-message\", 1);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.kunde);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"text\", ctx.errorMsg);\n    }\n  },\n  encapsulation: 2\n});","map":null,"metadata":{},"sourceType":"module"}